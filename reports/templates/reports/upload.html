{% load static %}
<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <title>Kompetensrapport</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="{% static 'reports/css/report.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
<div class="container">
  <h1>Generera kompetensrapport</h1>

  <div class="upload-box">
    <form method="post" enctype="multipart/form-data" >
      {% csrf_token %}
      {{ form.as_p }}
      <button class="btn btn-primary" type="submit">Ladda upp &amp; visa rapport</button>
    </form>
  </div>

  {% if error %}
    <p class="message error">{{ error }}</p>
  {% endif %}

{% if competencies %}
<div class="preview-card" id="reportBox">
  <div class="report-surface">
    {% include "reports/_report_content.html" %}
  </div>


    <script>
(function () {
  const elLabels = document.getElementById("radar-labels");
  const elValues = document.getElementById("radar-values");
  const canvas = document.getElementById("radarChart");
  if (!elLabels || !elValues || !canvas) return;

  const labels = JSON.parse(elLabels.textContent);
  const values = JSON.parse(elValues.textContent);

  const ctx = canvas.getContext("2d");
  new Chart(ctx, {
    type: "radar",
    data: {
      labels,
      datasets: [{
        data: values,
        fill: true,
        borderWidth: 2,
        pointRadius: 3,
        pointHoverRadius: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: { enabled: false }
      },
      scales: {
        r: {
          min: 0,
          max: 30,
          ticks: { display: false },
          pointLabels: { font: { size: 12 } },
          grid: { circular: true }
        }
      }
    }
  });
})();
</script>

  <a href="{% url 'report_pdf_download' %}" class="btn btn-secondary">Ladda ned som PDF</a>
  </div>

  <script>
    const labels = {{ chart_labels|safe }};
    const values = {{ chart_values|safe }};

    const ctx = document.getElementById('competencyChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{ label: 'Kompetenspo√§ng', data: values }]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true, max: 5 } } }
    });
  </script>
{% endif %}

</div>

<script>
  const fileInput = document.querySelector('#id_file');
  if (fileInput) fileInput.setAttribute('accept', '.xlsx,.xls');
</script>

</body>
</html>
