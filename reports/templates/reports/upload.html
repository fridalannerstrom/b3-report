<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <title>Kompetensrapport</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
/* =========================
   UPLOAD / APP LAYOUT
   ========================= */

body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#f5f5f7;
  margin:0;
  padding:2rem;
}

.container{
  max-width:900px;
  margin:0 auto;
  background:#fff;
  padding:2rem;
  border-radius:16px;
  box-shadow:0 18px 40px rgba(15,23,42,.12);
}

.upload-box{
  border:1px dashed #cbd5f5;
  padding:1.5rem;
  border-radius:12px;
  background:#f9fafb;
  margin-bottom:2rem;
}

.btn{
  display:inline-block;
  padding:.6rem 1.4rem;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-weight:600;
}

.btn-primary{ background:#4f46e5; color:#fff; }

.btn-secondary{
  background:#e5e7eb;
  color:#111827;
  text-decoration:none;
  margin-top:1rem;
}

.report-box{
  margin-top:1.5rem;
  border:1px solid #e5e7eb;
  border-radius:14px;
  padding:1.25rem;
  background:#fff;
}

.error{ color:#b91c1c; }


/* =========================
   REPORT CONTENT (so dots show on upload page)
   ========================= */

.report-section{ margin-top:24px; }
.report-section h2{ margin:0 0 8px; }
.report-section p{ margin:6px 0 0; }

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  border-bottom:1px solid #e5e7eb;
  padding:6px 4px;
  text-align:left;
}
th{ font-weight:600; color:#374151; }

.no-data{ font-style:italic; color:#6b7280; }

.b3-scale, .tq-scale{
  display:flex;
  align-items:center;
  gap:8px;
}

/* DOTS */
.dot{
  display:inline-block;
  width:14px;
  height:14px;
  border-radius:999px;
  border:2px solid #cbd5e1;
  background:#fff;
  box-sizing:border-box;
}
.dot.small{ width:10px; height:10px; }

.dot.filled{
  background:#6b5cff;
  border-color:#6b5cff;
}

/* Half dot */
.dot.half{
  background: linear-gradient(to right, #6b5cff 50%, #ffffff 50%);
  border-color:#cbd5e1;
}

.b3-group{
  margin-top:24px;
  padding:16px;
  border:1px solid #e5e7eb;
  border-radius:12px;
}

.b3-main-title{
  margin:0 0 8px;
  font-size:1.1rem;
}

.b3-main{ margin-bottom:12px; }

.b3-under-row{
  display:grid;
  grid-template-columns:1.5fr 1fr;
  gap:12px;
  padding:6px 0;
  border-top:1px solid #f1f5f9;
}

.b3-value{ font-weight:600; margin-left:6px; }
.b3-value.small{ font-size:.85rem; }

/* CALC BOXES */
.calc-details{ margin:6px 0 12px; }
.calc-summary{ cursor:pointer; font-weight:600; }
.calc-box{
  margin-top:8px;
  padding:10px 12px;
  border:1px solid #e5e7eb;
  border-radius:10px;
  background:#fafafa;
}
.calc-table{ margin-top:8px; font-size:.9rem; }
.calc-formula, .calc-line, .calc-result, .calc-missing{ margin-top:8px; }

/* MAPPING */
.map-card{
  border:1px solid #e5e7eb;
  border-radius:16px;
  background:#fff;
  padding:16px;
  margin-top:14px;
}
.map-row{
  display:grid;
  grid-template-columns:1.5fr 40px 1.5fr;
  gap:12px;
  padding:12px 0;
  border-top:1px solid #f1f5f9;
}
.map-row:first-child{ border-top:none; padding-top:6px; }
.map-behavior{ font-weight:600; }
.map-arrow{ font-size:18px; color:#64748b; text-align:center; }

/* CHIPS */
.chip-wrap{ display:flex; flex-wrap:wrap; gap:8px; }
.chip{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  background:#eef2ff;
  color:#3730a3;
  font-size:13px;
  font-weight:600;
}

  </style>
</head>
<body>
<div class="container">
  <h1>Generera kompetensrapport</h1>

  <div class="upload-box">
    <form method="post" enctype="multipart/form-data" >
      {% csrf_token %}
      {{ form.as_p }}
      <button class="btn btn-primary" type="submit">Ladda upp &amp; visa rapport</button>
    </form>
  </div>

  {% if error %}
    <p class="message error">{{ error }}</p>
  {% endif %}

{% if competencies %}
  <div class="report-box" id="reportBox">
    {% include "reports/_report_content.html" %}

    <a href="{% url 'report_pdf_download' %}" class="btn btn-secondary">Ladda ned som PDF</a>
  </div>

  <script>
    const labels = {{ chart_labels|safe }};
    const values = {{ chart_values|safe }};

    const ctx = document.getElementById('competencyChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{ label: 'Kompetenspo√§ng', data: values }]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true, max: 5 } } }
    });
  </script>
{% endif %}

</div>

<script>
  const fileInput = document.querySelector('#id_file');
  if (fileInput) fileInput.setAttribute('accept', '.xlsx,.xls');
</script>
</body>
</html>
